<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GÃ©nÃ©rateur LinkedIn â€” NB NEXT STEP</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--gold:#c4a470;--gold-light:#e8dcc8;--gold-dim:rgba(196,164,112,0.5);--gold-faint:rgba(196,164,112,0.06);--dark-bg:#0a0c10;--dark-mid:#131820;--text-light:#e8e4de;--text-dim:#8a8578;--border-faint:rgba(255,255,255,0.06);--border-active:rgba(196,164,112,0.5);--red:#e74c3c;--orange:#f39c12;--green:#27ae60}
body{min-height:100vh;background:linear-gradient(168deg,var(--dark-bg) 0%,var(--dark-mid) 40%,var(--dark-bg) 100%);font-family:'Cormorant Garamond',Georgia,serif;color:var(--text-light);line-height:1.5}
header{padding:36px 28px 28px;border-bottom:1px solid rgba(196,164,112,0.15);background:linear-gradient(180deg,var(--gold-faint) 0%,transparent 100%)}
.header-inner{max-width:880px;margin:0 auto;display:flex;align-items:center;gap:14px}
.logo-icon{width:44px;height:44px;background:linear-gradient(135deg,var(--gold),#8b7355);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;box-shadow:0 4px 20px rgba(196,164,112,0.25);flex-shrink:0}
.header-title{font-size:26px;font-weight:600;letter-spacing:.02em;background:linear-gradient(135deg,var(--gold-light),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.header-sub{font-size:12px;font-family:'DM Sans',sans-serif;color:rgba(196,164,112,0.6);letter-spacing:.15em;text-transform:uppercase}
main{max-width:880px;margin:0 auto;padding:28px 28px 60px}
.section-label{display:block;font-size:11px;font-family:'DM Sans',sans-serif;color:var(--gold-dim);letter-spacing:.2em;text-transform:uppercase;margin-bottom:12px}
.selector-row{display:flex;gap:12px;flex-wrap:wrap}
.selector-btn{flex:1 1 200px;padding:16px 20px;background:rgba(255,255,255,0.02);border:1px solid var(--border-faint);border-radius:12px;cursor:pointer;text-align:left;transition:all .3s ease;font-family:inherit;color:inherit}
.selector-btn:hover{border-color:rgba(196,164,112,0.25);background:rgba(196,164,112,0.04)}
.selector-btn.active{background:linear-gradient(135deg,rgba(196,164,112,0.18),rgba(196,164,112,0.08));border:1.5px solid var(--border-active);transform:translateY(-1px);box-shadow:0 8px 30px rgba(196,164,112,0.12)}
.selector-btn .btn-icon{font-size:20px;margin-bottom:5px}
.selector-btn .btn-name{font-size:16px;font-weight:600;color:var(--text-dim);margin-bottom:3px;font-family:'DM Sans',sans-serif}
.selector-btn.active .btn-name{color:var(--gold-light)}
.selector-btn .btn-desc{font-size:12px;font-family:'DM Sans',sans-serif;color:rgba(196,164,112,0.4)}
.var-field-group{margin:10px 0}
.var-field-label{display:block;font-size:12px;font-family:'DM Sans',sans-serif;color:var(--gold);margin-bottom:6px;text-transform:capitalize}
.var-field-input{width:100%;padding:10px 14px;background:rgba(255,255,255,0.04);border:1px solid rgba(196,164,112,0.2);border-radius:8px;color:var(--text-light);font-size:13px;font-family:'DM Sans',sans-serif;outline:none;transition:border-color .3s ease}
.var-field-input::placeholder{color:rgba(196,164,112,0.3);font-style:italic}
.var-field-input:focus{border-color:var(--gold);box-shadow:0 0 12px rgba(196,164,112,0.15)}
.combo-info{margin-top:16px;padding:12px 16px;background:rgba(196,164,112,0.06);border:1px solid rgba(196,164,112,0.12);border-radius:10px;font-size:12px;font-family:'DM Sans',sans-serif;color:rgba(196,164,112,0.5);line-height:1.6}
.combo-info strong{color:rgba(196,164,112,0.7)}
.editor-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.char-counter-wrap{display:flex;align-items:center;gap:10px}
.char-bar{width:110px;height:4px;background:rgba(255,255,255,0.06);border-radius:2px;overflow:hidden}
.char-bar-fill{height:100%;border-radius:2px;transition:width .3s ease,background .3s ease}
.char-bar-fill.normal{background:linear-gradient(90deg,var(--gold),#8b7355)}
.char-bar-fill.warning{background:linear-gradient(90deg,var(--orange),#e67e22)}
.char-bar-fill.danger{background:linear-gradient(90deg,var(--red),#c0392b)}
.char-count{font-size:13px;font-family:'DM Mono','Courier New',monospace;color:rgba(196,164,112,0.6);min-width:85px;text-align:right}
.char-count.warning{color:var(--orange)}
.char-count.danger{color:var(--red);font-weight:700}
#editor{width:100%;min-height:380px;padding:22px 24px;background:rgba(255,255,255,0.02);border:1px solid var(--border-faint);border-radius:14px;color:var(--text-light);font-size:14px;font-family:'DM Sans','Helvetica Neue',sans-serif;line-height:1.75;resize:vertical;outline:none;transition:border-color .3s ease}
#editor:focus{border-color:rgba(196,164,112,0.4)}
#editor.overlimit{border-color:rgba(231,76,60,0.5)}
.overlimit-msg{margin-top:8px;padding:10px 14px;background:rgba(231,76,60,0.1);border:1px solid rgba(231,76,60,0.25);border-radius:8px;font-size:13px;font-family:'DM Sans',sans-serif;color:var(--red);display:none}
.overlimit-msg.visible{display:block}
.actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:28px}
.btn-generate{flex:1 1 220px;padding:16px 24px;background:linear-gradient(135deg,#2d6a4f,#1b4332);border:1.5px solid rgba(45,106,79,0.6);border-radius:12px;cursor:pointer;font-size:15px;font-family:'DM Sans',sans-serif;font-weight:600;color:#95d5b2;transition:all .3s ease;letter-spacing:.02em}
.btn-generate:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(45,106,79,0.35);background:linear-gradient(135deg,#40916c,#2d6a4f)}
.btn-copy{flex:1 1 200px;padding:15px 24px;background:linear-gradient(135deg,var(--gold),#8b7355);border:none;border-radius:12px;cursor:pointer;font-size:15px;font-family:'DM Sans',sans-serif;font-weight:600;color:var(--dark-bg);transition:all .3s ease;box-shadow:0 4px 20px rgba(196,164,112,0.25);letter-spacing:.02em}
.btn-copy:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(196,164,112,0.35)}
.btn-copy.copied{background:linear-gradient(135deg,var(--green),#1e8449)}
.footer-guide{margin-top:44px;padding:18px 22px;background:rgba(196,164,112,0.04);border-radius:12px;border:1px solid rgba(196,164,112,0.08);font-size:12px;font-family:'DM Sans',sans-serif;color:rgba(196,164,112,0.4);line-height:1.7}
.footer-guide strong{color:rgba(196,164,112,0.6)}
.mb-32{margin-bottom:32px}
.mb-24{margin-bottom:24px}
@media(max-width:600px){header{padding:24px 16px 20px}main{padding:20px 16px 40px}.header-title{font-size:22px}.selector-btn{flex:1 1 100%}#editor{min-height:300px;padding:16px 18px}}
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo-icon">âœ¦</div>
    <div>
      <h1 class="header-title">GÃ©nÃ©rateur LinkedIn</h1>
      <p class="header-sub">NB NEXT STEP â€” LAB Profile Â· Variations alÃ©atoires</p>
    </div>
  </div>
</header>

<main>
  <section class="mb-32">
    <span class="section-label">MÃ©taprogramme cible</span>
    <div class="selector-row mb-24" id="meta-selectors"></div>
    <span class="section-label">Offre</span>
    <div class="selector-row" id="offre-selectors"></div>
  </section>

  <!-- PERSONNALISATION -->
  <section class="mb-32" id="var-section">
    <span class="section-label">âœï¸ Personnaliser (optionnel)</span>
    <div id="var-fields"></div>
    <div class="combo-info" id="combo-info"></div>
  </section>

  <!-- EDITOR -->
  <section>
    <div class="editor-header">
      <span class="section-label" style="margin-bottom:0">Ã‰diteur de post</span>
      <div class="char-counter-wrap">
        <div class="char-bar"><div class="char-bar-fill normal" id="char-bar-fill"></div></div>
        <span class="char-count" id="char-count">0 / 1400</span>
      </div>
    </div>
    <textarea id="editor"></textarea>
    <div class="overlimit-msg" id="overlimit-msg"></div>
  </section>

  <div class="actions">
    <button class="btn-generate" id="btn-generate">ğŸ² GÃ©nÃ©rer un nouveau post</button>
    <button class="btn-copy" id="btn-copy">Copier le post</button>
  </div>

  <div class="footer-guide">
    <strong>Guide LAB Profile</strong> â€” 
    Â« S'Ã©loigner de Â» : motive par les consÃ©quences nÃ©gatives et les risques. Mots clÃ©s : Ã©viter, prÃ©venir, avant qu'il ne soit trop tard.
    Â« RÃ©fÃ©rence interne Â» : valorise l'autonomie de dÃ©cision. Mots clÃ©s : vous savez, votre choix, gardez le contrÃ´le, Ã  vous de juger.
    <br><br><strong>Vocabulaire plaquette</strong> â€” surcharge cognitive Â· tensions invisibles Â· rythme dÃ©cisionnel Â· rÃ©guler l'humain Â· cadre clair Â· rÃ©gulation fine Â· continuitÃ© Â· Diagnostic NEXT STEP Â· dÃ©cider avec clartÃ©, avancer avec justesse.
  </div>
</main>

<script>
const MAX_CHARS = 1400;

// ========================================
// BLOCS ALÃ‰ATOIRES PAR COMBINAISON
// Chaque combinaison a : hooks[], bodies[], ctas[], variables
// Le gÃ©nÃ©rateur pioche 1 hook + 1 body + 1 cta au hasard
// ========================================

const BLOCKS = {
  seloigner: {
    codir: {
      hooks: [
        // CURIOSITÃ‰
        "ğŸ§  Votre CODIR est compÃ©tent. Vos dÃ©cisions sont bien pensÃ©es.\nMais quelque chose ralentit l'exÃ©cution.",
        "ğŸ”‡ Votre CODIR se parleâ€¦ mais ne se dit plus rien.",
        "â“ Savez-vous combien coÃ»te un CODIR qui dysfonctionne ?\nLa rÃ©ponse va vous surprendre.",
        "ğŸ” Il existe un problÃ¨me que 80% des dirigeants voient\nmais que personne n'ose nommer.",
        // CONTROVERSE
        "âš¡ 50% des Ã©checs stratÃ©giques naissent d'un CODIR divisÃ©.\nPas d'un mauvais marchÃ©.",
        "ğŸš« Le team building ne rÃ©sout rien.\nVoilÃ , c'est dit.",
        "ğŸ’£ Votre prochain sÃ©minaire CODIR sera inutile.\nSauf si vous changez d'approche.",
        "ğŸ¤· On dÃ©pense des fortunes en stratÃ©gie.\nMais on ne rÃ©gule jamais l'humain qui l'exÃ©cute.",
        // STORYTELLING
        "ğŸšª Quand votre meilleur Ã©lÃ©ment claque la porte, il est dÃ©jÃ  trop tard.",
        "ğŸ’” La confiance dans votre CODIR s'Ã©rode.\nEt personne n'en parle.",
        "ğŸ“‰ Un CODIR que j'ai accompagnÃ© perdait 2 cadres dirigeants par an.\nLe problÃ¨me n'Ã©tait pas le salaire.",
        "ğŸ”¥ Votre CODIR gÃ¨re des urgences. Mais qui gÃ¨re le CODIR ?",
        // AFFIRMATION AUDACIEUSE
        "âš–ï¸ Ce n'est pas plus de contrÃ´le qu'il vous faut.\nC'est plus de justesse.",
        "ğŸ’¡ Le vrai problÃ¨me de votre CODIR n'est pas stratÃ©gique.\nIl est humain.",
        "ğŸš€ Vous Ãªtes en hypercroissance.\nMais votre CODIR tient-il vraiment le rythme ?",
        // QUESTION PROVOCANTE
        "â±ï¸ Vos dÃ©cisions arrivent trop vite. Ou trop tard.\nDans les deux cas, Ã§a coÃ»te cher.",
        "ğŸ˜¶ Non-dits, crispations, usure relationnelle.\nVotre CODIR fonctionne en mode survie.",
        "ğŸ‹ï¸ Combien de temps encore allez-vous porter seul\ndes dÃ©cisions qui devraient Ãªtre collectives ?"
      ],
      bodies: [
        // PILIER 1 : Diagnostic du problÃ¨me (Ã©ducatif)
        "Ce Â« quelque chose Â», c'est rarement visible dans un reporting :\n\nâš¡ Surcharge cognitive â€” dÃ©cisions en cascade, perte de hiÃ©rarchie, informations non triÃ©es\nğŸ˜¶ Tensions invisibles â€” non-dits, crispations, usure relationnelle qui saturent les Ã©changes\nâ±ï¸ Rythme dÃ©cisionnel dÃ©rÃ©glÃ© â€” dÃ©cisions trop rapides ou trop tardives, perte de timing\n\nLe dirigeant dÃ©cide. L'Ã©quipe exÃ©cute.\nMais l'Ã©tat interne n'est jamais adressÃ©. ğŸ”‡\n\nRÃ©sultat : dÃ©cisions plus rigides, relations plus tendues, signaux faibles ignorÃ©s.\n\nCe n'est pas un problÃ¨me de stratÃ©gie.\nC'est un problÃ¨me de rythme humain. ğŸ’¡\n\nAvant d'optimiser un systÃ¨me, il faut rÃ©guler l'humain qui le pilote.",
        // PILIER 2 : La mÃ©thode NEXT STEP (Ã©ducatif + promotionnel)
        "Ce que j'observe dans les CODIR que j'accompagne :\n\nLes dÃ©saccords ne disparaissent pas.\nâ†’ Ils deviennent plus utiles. âœ…\n\nLa pression reste.\nâ†’ Mais elle ne parasite plus la dÃ©cision. ğŸ¯\n\nComment ? En rÃ©gulant l'humain lÃ  oÃ¹ les dÃ©cisions se jouent :\n\nğŸ”§ Un cadre clair â€” espaces dÃ©finis, objectifs explicites, confidentialitÃ© absolue\nğŸ” Une rÃ©gulation fine â€” lecture des dynamiques, ajustement en temps rÃ©el, attention Ã  ce qui ne se dit pas\nğŸ“… De la continuitÃ© â€” avant les dÃ©cisions clÃ©s, pendant les phases de tension, aprÃ¨s pour stabiliser\n\nNB NEXT STEP n'intervient pas sur vos processus.\nNous rÃ©gulons l'humain qui les pilote. ğŸ§ ",
        // PILIER 3 : Le coÃ»t de l'inaction (Ã©motionnel)
        "Ce que personne ne mesure :\n\nğŸ’¸ CoÃ»t d'un dÃ©part cadre dirigeant : 6 Ã  12 mois de salaire\nğŸ“‰ Signal envoyÃ© aux Ã©quipes : Â« ici, les signaux faibles sont ignorÃ©s Â»\nğŸ”„ Effet domino : aprÃ¨s un dÃ©part, d'autres suivent\n\nLe vrai problÃ¨me ?\n\nğŸ§  Surcharge cognitive non rÃ©gulÃ©e\nğŸ˜¶ Tensions invisibles jamais adressÃ©es\nâ±ï¸ Rythme dÃ©cisionnel qui Ã©puise au lieu d'aligner\n\nAvant d'optimiser un systÃ¨me, il faut rÃ©guler l'humain qui le pilote. ğŸ’¡\n\nNB NEXT STEP : sessions de rÃ©gulation CODIR, suivi inter-sessions, restitution actionnable.",
        // PILIER 4 : Les silos Ã©motionnels (storytelling)
        "Votre CODIR fonctionne en silos Ã©motionnels :\n\nğŸ´ Chacun dÃ©fend son pÃ©rimÃ¨tre au lieu du projet commun\nğŸ¤« Les dÃ©cisions sont prises puis sabotÃ©es en silence\nâš–ï¸ Le DG arbitre au lieu de fÃ©dÃ©rer\n\nSans intervention, ce schÃ©ma se rÃ©pÃ¨te. AnnÃ©e aprÃ¨s annÃ©e. ğŸ”\n\nChez NB NEXT STEP, on rÃ©gule l'humain lÃ  oÃ¹ les dÃ©cisions se jouent.\n\nğŸ”§ Cadre clair â€” espaces dÃ©finis, objectifs explicites\nğŸ” RÃ©gulation fine â€” lecture des dynamiques en temps rÃ©el\nğŸ“… ContinuitÃ© â€” avant, pendant et aprÃ¨s les tensions\n\nQuand l'humain est rÃ©gulÃ©, les dÃ©cisions deviennent plus claires. âœ¦",
        // PILIER 5 : Contexte transformation (segment spÃ©cifique)
        "En phase de transformation (levÃ©e, M&A, rÃ©org, hypercroissance), les enjeux explosent :\n\nğŸ§  CODIR saturÃ© â€” trop de dÃ©cisions, pas assez de recul\nâš¡ DÃ©cisions en cascade â€” plus personne ne sait qui arbitre quoi\nğŸ˜¶ Tensions nouvelles â€” des profils qui ne se connaissaient pas doivent dÃ©cider ensemble\n\nLe rÃ©flexe classique : recruter, structurer, processer.\nMais personne ne rÃ©gule l'humain qui pilote tout Ã§a. ğŸ”‡\n\nNB NEXT STEP intervient avec un cadre clair et une rÃ©gulation fine.\nDÃ©cider avec clartÃ©. Avancer avec justesse. âœ¦",
        // PILIER 6 : Les rÃ©sultats concrets (preuve sociale)
        "Ce que Ã§a change concrÃ¨tement quand l'humain est rÃ©gulÃ© :\n\nâœ… DÃ©cisions prises avec moins de friction\nâœ… Ã‰changes plus fluides et directs\nâœ… Moins de temps perdu Ã  rÃ©parer aprÃ¨s coup\nâœ… Meilleure qualitÃ© de prÃ©sence en rÃ©union\nâœ… Ã‰nergie dirigeante mieux utilisÃ©e\n\nLes dÃ©saccords ne disparaissent pas. Ils deviennent plus utiles. ğŸ¯\nLa pression reste. Mais elle ne parasite plus la dÃ©cision.\n\nCe n'est pas un problÃ¨me de stratÃ©gie. C'est un problÃ¨me de rythme humain.\nAvant d'optimiser un systÃ¨me, il faut rÃ©guler l'humain qui le pilote. ğŸ§ ",
        // PILIER 7 : Pourquoi les approches classiques Ã©chouent (Ã©ducatif + controverse)
        "SÃ©minaire au vert, formation leadership, coaching individuelâ€¦\nVous avez dÃ©jÃ  essayÃ©. Et Ã§a n'a pas tenu. ğŸ“‰\n\nPourquoi ?\n\nâŒ Le sÃ©minaire crÃ©e un Ã©lan â€” mais pas de cadre pour le maintenir\nâŒ Le coaching individuel ignore la dynamique collective\nâŒ La formation dÃ©livre des concepts â€” mais ne rÃ©gule rien\n\nCe qui manque Ã  ces approches :\n\nğŸ”§ Un cadre clair qui structure les Ã©changes dans la durÃ©e\nğŸ” Une rÃ©gulation fine qui lit ce qui ne se dit pas\nğŸ“… De la continuitÃ© â€” pas un one-shot, un vrai accompagnement\n\nC'est exactement ce que fait NB NEXT STEP.\nRÃ©guler l'humain lÃ  oÃ¹ les dÃ©cisions se jouent. ğŸ§ ",
        // PILIER 8 : Le dirigeant isolÃ© (segment frustration)
        "Le dirigeant porte tout :\n\nğŸ‹ï¸ Les arbitrages que personne ne veut assumer\nğŸ”‹ L'Ã©nergie relationnelle qui compense les failles du collectif\nğŸ§  La charge cognitive d'un CODIR qui dysfonctionne en silence\n\nRÃ©sultat ?\nDes dÃ©cisions de plus en plus rigides.\nUne fatigue qui s'installe.\nDes signaux faibles ignorÃ©s parce qu'il n'y a plus de bande passante. ğŸ˜¶\n\nRÃ©guler le CODIR, ce n'est pas un luxe.\nC'est ce qui permet au dirigeant de retrouver sa capacitÃ© de vision.\n\nNB NEXT STEP : cadre clair Â· rÃ©gulation fine Â· continuitÃ©.\nQuand l'humain est rÃ©gulÃ©, les dÃ©cisions deviennent plus claires. âœ¦"
      ],
      ctas: [
        "ğŸ¯ Diagnostic NEXT STEP : Â½ journÃ©e avec votre CODIR.\nRestitution structurÃ©e et actionnable.\n2 500â‚¬ HT Â· contact@nb-nextstep.fr",
        "ğŸ“ On commence toujours par le Diagnostic NEXT STEP.\nÂ½ journÃ©e Â· Lecture claire des zones de tension Â· Sans engagement.\ncontact@nb-nextstep.fr",
        "ğŸ’¬ Curieux ? Le Diagnostic NEXT STEP pose les bases en Â½ journÃ©e.\n2 500â‚¬ HT Â· contact@nb-nextstep.fr",
        "â° Avant que Ã§a ne s'aggrave, posons un diagnostic.\nÂ½ journÃ©e Â· Restitution actionnable Â· 2 500â‚¬ HT\ncontact@nb-nextstep.fr",
        "ğŸ“… Prochaine Ã©tape : le Diagnostic NEXT STEP.\nLa clartÃ© prÃ©cÃ¨de toujours la dÃ©cision.\ncontact@nb-nextstep.fr",
        "ğŸ”§ Vous ne savez pas par oÃ¹ commencer ?\nLe Diagnostic NEXT STEP est fait pour Ã§a.\nÂ½ journÃ©e Â· Sans engagement Â· contact@nb-nextstep.fr",
        "ğŸ’¡ Et si en Â½ journÃ©e, vous aviez enfin une lecture claire\nde ce qui bloque votre CODIR ?\nDiagnostic NEXT STEP Â· contact@nb-nextstep.fr",
        "ğŸ¤ Pas de programme standard chez NB NEXT STEP.\nOn commence par comprendre. Puis on rÃ©gule.\ncontact@nb-nextstep.fr"
      ],
      variables: ["secteur"],
      placeholders: {"secteur": "ex : tech, industrie, scale-up, post-levÃ©e, M&Aâ€¦"}
    },
    cap_cohesion: {
      hooks: [
        // CURIOSITÃ‰
        "ğŸ˜¶ Vos agents ne dÃ©missionnent pas. Ils se dÃ©sengagent. C'est pire.",
        "ğŸ“Š L'absentÃ©isme grimpe. Les projets n'avancent pas.\nEt si le problÃ¨me venait du sommet ?",
        "â“ Pourquoi les meilleures collectivitÃ©s perdent leurs meilleurs DGS ?\nLa rÃ©ponse n'est jamais dans l'audit.",
        // CONTROVERSE
        "âš¡ Quand l'Ã©lu et le DGS ne s'alignent pas, c'est toute la collectivitÃ© qui trinque.",
        "ğŸš« Les diagnostics RPS ne changent rien.\nVoilÃ  pourquoi.",
        "ğŸ¤· On audite, on diagnostique, on recommande.\nMais on ne rÃ©gule jamais l'humain qui dÃ©cide.",
        // STORYTELLING
        "ğŸ˜“ Un DGS Ã©puisÃ©, des directeurs dÃ©motivÃ©s, des agents en retrait.\nVous reconnaissez le tableau ?",
        "ğŸ”¥ Burn-out au CODIR, conflit en conseil municipal, pÃ©tition d'agents.\nCes crises ne surgissent jamais de nulle part.",
        "ğŸ“‰ Une collectivitÃ© que j'ai accompagnÃ©e perdait un directeur par an.\nLe problÃ¨me n'Ã©tait pas le recrutement.",
        // AFFIRMATION AUDACIEUSE
        "ğŸ”‡ Dans votre collectivitÃ©, l'Ã©tat interne de l'Ã©quipe de direction n'est jamais adressÃ©.",
        "ğŸ›ï¸ Le service public souffre.\nMais pas par manque de moyens â€” par manque de rÃ©gulation au sommet.",
        // QUESTION PROVOCANTE
        "â±ï¸ Combien de temps encore votre DGS va-t-il tenir seul\nce que toute une Ã©quipe devrait porter ?",
        "ğŸ§  Votre Ã©quipe de direction gÃ¨re des crises.\nMais qui gÃ¨re l'Ã©quipe de direction ?"
      ],
      bodies: [
        // DÃ©sengagement
        "Dans les collectivitÃ©s, on ne parle pas de Â« quiet quitting Â».\nMais les symptÃ´mes sont lÃ  :\n\nğŸ“Š L'absentÃ©isme grimpe sans explication mÃ©dicale\nğŸŒ Les projets avancent au ralenti malgrÃ© les moyens\nğŸ˜¤ Les Ã©lus se plaignent, les DGS subissent, les agents encaissent\n\nLe problÃ¨me n'est pas le manque de moyens.\nC'est que l'Ã©tat interne de l'Ã©quipe de direction n'est jamais adressÃ©. ğŸ”‡\n\nSurcharge cognitive, tensions invisibles, rythme dÃ©cisionnel dÃ©rÃ©glÃ©.\n\nâœ… Cap CohÃ©sion : 6 mois pour rÃ©guler l'humain qui pilote votre collectivitÃ©.\nCadre clair Â· RÃ©gulation fine Â· ContinuitÃ© ğŸ§ ",
        // Ã‰lu / DGS
        "Personne n'en parle ouvertement. Mais tout le monde le sent :\n\nğŸ­ Les arbitrages changent selon l'humeur politique\nğŸ§­ Les directeurs naviguent Ã  vue entre deux autoritÃ©s\nâ“ Les agents perdent le sens de leur mission\n\nCe n'est pas un problÃ¨me de compÃ©tence.\nC'est un problÃ¨me de rythme humain. â±ï¸\n\nğŸ›ï¸ Cap CohÃ©sion rÃ©gule les dynamiques invisibles entre Ã©lus et administration.\nğŸ”§ Cadre clair Â· RÃ©gulation fine Â· ContinuitÃ©\n\nOn ne touche pas aux processus. On rÃ©gule l'humain qui les pilote.\nQuand l'humain est rÃ©gulÃ©, les dÃ©cisions deviennent plus claires. âœ¦",
        // Crise annoncÃ©e
        "Ces crises ne surgissent jamais de nulle part :\n\nğŸ”¥ Un burn-out en comitÃ© de direction\nğŸ’¥ Un conflit ouvert en conseil municipal\nğŸ“ Une pÃ©tition d'agents\n\nElles sont le rÃ©sultat de mois de surcharge cognitive, de tensions invisibles et de rythme dÃ©cisionnel dÃ©rÃ©glÃ©. â³\n\nğŸ›¡ï¸ Cap CohÃ©sion intervient AVANT la crise.\nOn ne touche pas aux processus. On rÃ©gule l'humain qui les pilote.\n\nâœ… Atelier dÃ©couverte de 3h\nâœ… Programme en 3 phases sur 6 mois\nâœ… RÃ©sultats mesurables\nâœ… MÃ©thodologie PNL adaptÃ©e au service public",
        // Ã‰chec des audits
        "Le problÃ¨me des approches classiques en collectivitÃ© :\n\nâŒ Les audits dÃ©crivent le problÃ¨me sans donner les outils\nâŒ Ils ignorent la surcharge cognitive et les tensions invisibles\nâŒ Ils crÃ©ent de la dÃ©pendance au consultant\n\nğŸ›ï¸ Cap CohÃ©sion est l'inverse d'un audit.\nC'est un programme de rÃ©gulation. ğŸ’ª\n\nEn 6 mois, on rÃ©gule l'humain qui pilote votre collectivitÃ©.\nCadre clair Â· RÃ©gulation fine Â· ContinuitÃ© ğŸ§ \n\nAvant d'optimiser un systÃ¨me, il faut rÃ©guler l'humain qui le pilote. âœ¦",
        // DGS isolÃ© (nouveau segment)
        "Le DGS porte tout :\n\nğŸ‹ï¸ L'interface permanente entre Ã©lus et administration\nğŸ§  La surcharge cognitive de dÃ©cisions qui ne lui appartiennent pas toutes\nğŸ˜” L'isolement au sommet â€” personne pour rÃ©guler ce qu'il perÃ§oit\n\nRÃ©sultat ?\nDes directions qui fonctionnent en silos.\nDes tensions qui s'installent.\nUn service public qui fonctionne malgrÃ© sa direction, pas grÃ¢ce Ã  elle. ğŸ˜¬\n\nCap CohÃ©sion donne au DGS ce qui lui manque :\nUn cadre. Des outils. De la continuitÃ©.\nPour rÃ©guler l'humain au sommet de la collectivitÃ©. ğŸ›ï¸",
        // RÃ©sultats concrets (nouveau)
        "Ce que Ã§a change concrÃ¨tement quand l'Ã©quipe de direction est rÃ©gulÃ©e :\n\nâœ… Les projets transversaux avancent sans avoir besoin d'Ãªtre poussÃ©s\nâœ… Les directeurs prennent des dÃ©cisions sans remonter au DGS\nâœ… Les tensions sont nommÃ©es et traitÃ©es, pas subies\nâœ… Le service aux usagers s'amÃ©liore â€” naturellement\n\nCe n'est pas de la magie. C'est de la rÃ©gulation.\nCadre clair Â· RÃ©gulation fine Â· ContinuitÃ© ğŸ”§\n\nQuand l'humain est rÃ©gulÃ©, le service public gagne en justesse. âœ¦"
      ],
      ctas: [
        "ğŸ’¡ L'immobilisme coÃ»te plus cher que le changement.\nParlons-en â†’ lien en commentaire",
        "ğŸš¨ Avant que la fracture ne devienne publique, agissons.\nâ†’ lien en commentaire",
        "ğŸ“… Ne laissez pas la crise dÃ©cider du calendrier.\nCap CohÃ©sion â†’ lien en commentaire",
        "ğŸ›ï¸ Cap CohÃ©sion : 6 mois pour rÃ©guler l'humain qui pilote.\nAtelier dÃ©couverte â†’ lien en commentaire",
        "ğŸ”§ Envie de comprendre comment Ã§a fonctionne ?\nUn atelier dÃ©couverte de 3h suffit pour poser les bases.\nâ†’ lien en commentaire",
        "ğŸ“ Ã‰changeons 20 minutes.\nSans jargon, sans engagement.\nâ†’ lien en commentaire"
      ],
      variables: ["collectivite"],
      placeholders: {"collectivite": "ex : commune, intercommunalitÃ©, dÃ©partementâ€¦"}
    }
  },
  ref_interne: {
    codir: {
      hooks: [
        // CURIOSITÃ‰
        "ğŸ‘ï¸ Vous le savez dÃ©jÃ  : votre CODIR ne fonctionne pas Ã  son plein potentiel.",
        "ğŸ“Š Et si vous pouviez piloter la santÃ© humaine de votre CODIR en temps rÃ©el ?",
        "â“ Pourquoi les dirigeants les plus lucides attendent-ils avant d'agir ?\nParce que personne ne leur propose le bon outil.",
        // AFFIRMATION (autonomie)
        "ğŸ¯ Vous sentez que quelque chose ne tourne pas rond dans votre CODIR.\nFaites-vous confiance.",
        "âš”ï¸ Transformer un CODIR, Ã§a ne se dÃ©lÃ¨gue pas. Ã‡a se dÃ©cide.",
        "ğŸ’¡ Votre instinct de dirigeant vous dit que quelque chose cloche.\nIl a raison.",
        "âš–ï¸ Ce n'est pas plus de contrÃ´le. C'est plus de justesse.\nEt c'est vous qui en dÃ©cidez.",
        // CONTRÃ”LE / AUTONOMIE
        "ğŸ”§ Vous n'avez pas besoin d'un Ã©niÃ¨me consultant.\nVous avez besoin d'outils que vous maÃ®trisez.",
        "ğŸ¯ Vous n'avez pas besoin qu'on vous dise quoi faire.\nVous avez besoin d'outils pour faire ce que vous savez dÃ©jÃ .",
        "ğŸ”‘ Les meilleurs dirigeants ne cherchent pas des rÃ©ponses.\nIls cherchent les bons outils pour trouver les leurs.",
        // STORYTELLING (dÃ©cision)
        "ğŸ“‰ Un dirigeant m'a dit : Â« Je sais exactement ce qui ne va pas.\nMais je n'ai pas les outils pour y remÃ©dier. Â»",
        "ğŸ‹ï¸ Vous portez seul des dÃ©cisions qui devraient Ãªtre collectives.\nCe n'est pas tenable. Et vous le savez."
      ],
      bodies: [
        // Diagnostic lucide
        "Vous n'avez pas besoin qu'on vous le dise. Vous le voyez :\n\nğŸ§  Surcharge cognitive â€” trop de dÃ©cisions en cascade, plus de hiÃ©rarchie\nğŸ˜¶ Tensions invisibles â€” des non-dits qui saturent chaque Ã©change\nâ±ï¸ Rythme dÃ©cisionnel dÃ©rÃ©glÃ© â€” trop vite ou trop tard\n\nCe qu'il vous manque n'est pas un consultant de plus.\nC'est une rÃ©gulation fine de l'humain qui pilote vos dÃ©cisions. ğŸ”§\n\nNB NEXT STEP : cadre clair, sessions de rÃ©gulation CODIR, suivi en continu.\nğŸ¯ Vous gardez le contrÃ´le. Vous gagnez en justesse.\n\nDÃ©cider avec clartÃ©. Avancer avec justesse. âœ¦",
        // Instinct dirigeant
        "Les chiffres sont bons. Officiellement, tout va bien. âœ…\n\nMais votre instinct perÃ§oit autre chose :\n\nğŸ¤ Les vraies conversations n'ont pas lieu en rÃ©union\nğŸ­ Certains membres jouent solo derriÃ¨re un vernis collectif\nğŸ”‹ Vous compensez les failles relationnelles par votre propre Ã©nergie\n\nCe que vous percevez a un nom :\ntensions invisibles, surcharge cognitive, rythme dÃ©cisionnel dÃ©rÃ©glÃ©. ğŸ”\n\nMoi, je rÃ©gule l'humain lÃ  oÃ¹ les dÃ©cisions se jouent.\nğŸ”§ Lecture des dynamiques Â· Ajustement en temps rÃ©el Â· Attention Ã  ce qui ne se dit pas\n\nğŸ”‘ Pas de dÃ©pendance. Vous repartez avec des outils que vous maÃ®trisez.",
        // Les formules (offre concrÃ¨te)
        "NB NEXT STEP propose deux formules ajustÃ©es Ã  votre rÃ©alitÃ© :\n\nğŸ“‹ Formule Essentielle â€” RÃ©gulation continue sur 3 mois\nÂ· 6 sessions collectives de rÃ©gulation CODIR (2h)\nÂ· 3 sessions individuelles dirigeants (1h)\nÂ· Plateforme de suivi NEXT STEP\nÂ· Suivi inter-sessions + restitution mensuelle\nğŸ’° 15 000â‚¬ HT\n\nğŸ”¥ Formule Intensive â€” Accompagnement renforcÃ© sur 6 mois\nÂ· 12 sessions collectives + 6 individuelles\nÂ· Accompagnement lors de 2 moments stratÃ©giques\nÂ· Suivi prioritaire + restitution bi-mensuelle\nğŸ’° 26 000â‚¬ HT\n\nPas de programme standard. Ajustement au rythme rÃ©el de votre organisation. âœ¦",
        // Dashboard de suivi
        "Chaque accompagnement NEXT STEP inclut un dashboard de suivi :\n\nğŸ¯ ClartÃ© dÃ©cisionnelle â€” Ã©volution de la qualitÃ© des dÃ©cisions\nâš¡ Tensions perÃ§ues â€” identification des zones de friction\nğŸ§˜ QualitÃ© de prÃ©sence â€” niveau d'engagement en rÃ©union CODIR\nğŸš¨ Signaux d'alerte â€” dÃ©tection prÃ©coce des surcharges\n\nLa plupart des accompagnements se fient au ressenti du consultant.\nNous, on mesure. Vous voyez l'Ã©volution. Vous dÃ©cidez en connaissance de cause. ğŸ“ˆ\n\nC'est votre tableau de bord. Pas celui du coach. Le vÃ´tre. ğŸ¯\n\nQuand l'humain est rÃ©gulÃ©, les dÃ©cisions deviennent plus claires. âœ¦",
        // Pourquoi les approches classiques Ã©chouent
        "Vous avez probablement dÃ©jÃ  essayÃ© : sÃ©minaire, team building, coaching.\nRÃ©sultat : un effet soufflÃ© qui retombe en 3 semaines. ğŸ“‰\n\nPourquoi ? Parce que ces approches touchent la surface.\nPas le rythme humain qui conditionne chaque dÃ©cision.\n\nğŸ”§ NB NEXT STEP travaille en profondeur :\nÂ· Cadre clair â€” espaces dÃ©finis, objectifs explicites, confidentialitÃ© absolue\nÂ· RÃ©gulation fine â€” lecture des dynamiques, ajustement en temps rÃ©el\nÂ· ContinuitÃ© â€” avant, pendant et aprÃ¨s les phases de tension\n\nVous gardez le contrÃ´le du processus. Vous gagnez en justesse. ğŸ¯\nDÃ©cider avec clartÃ©. Avancer avec justesse. âœ¦",
        // Autonomie et maÃ®trise (nouveau â€” valorise la rÃ©fÃ©rence interne)
        "Ce que NB NEXT STEP vous apporte, ce n'est pas une dÃ©pendance.\nC'est le contraire.\n\nÃ€ l'issue de l'accompagnement :\n\nğŸ”‘ Vous savez lire les dynamiques de votre CODIR\nğŸ”§ Vous avez des outils concrets pour rÃ©guler les tensions\nğŸ“Š Vous disposez d'indicateurs pour piloter la santÃ© humaine de votre Ã©quipe\nğŸ¯ Vous Ãªtes autonome\n\nNB NEXT STEP vous donne les clÃ©s.\nVous dÃ©cidez quand et comment les utiliser.\n\nPas de contrat au long cours. Pas de dÃ©pendance au coach.\nJuste des outils qui vous rendent meilleur stratÃ¨ge. âœ¦",
        // Vision vs arbitrage (nouveau â€” frustration segment dirigeant)
        "Votre rÃ´le, c'est la vision.\nPas l'arbitrage permanent. ğŸ¯\n\nMais quand le CODIR dysfonctionne, le dirigeant devient pompier :\n\nğŸ‹ï¸ Il porte les dÃ©cisions que le collectif devrait assumer\nğŸ”‹ Il compense par son Ã©nergie ce que la dynamique ne produit pas\nâ±ï¸ Il perd son temps en rÃ©gulation informelle au lieu de piloter\n\nRÃ©guler le CODIR, c'est rendre au dirigeant sa capacitÃ© de vision.\n\nğŸ”§ NB NEXT STEP : cadre clair Â· rÃ©gulation fine Â· continuitÃ©\nVous reprenez la main. Pas sur les gens â€” sur la dynamique. âœ¦"
      ],
      ctas: [
        "âœŠ Vous savez ce qu'il faut faire.\nDiagnostic NEXT STEP : Â½ journÃ©e Â· 2 500â‚¬ HT\ncontact@nb-nextstep.fr",
        "ğŸ’¡ Votre luciditÃ© est votre meilleur atout.\nDiagnostic NEXT STEP â†’ contact@nb-nextstep.fr",
        "ğŸ¤ La dÃ©cision vous appartient. Les outils sont prÃªts.\nÂ½ journÃ©e Â· 2 500â‚¬ HT Â· contact@nb-nextstep.fr",
        "ğŸ”§ DÃ©couvrez l'approche NEXT STEP.\nDiagnostic : Â½ journÃ©e Â· Sans engagement\ncontact@nb-nextstep.fr",
        "ğŸ“… PremiÃ¨re Ã©tape : le Diagnostic NEXT STEP.\nLa clartÃ© prÃ©cÃ¨de toujours la dÃ©cision.\ncontact@nb-nextstep.fr"
      ],
      variables: ["contexte"],
      placeholders: {"contexte": "ex : levÃ©e, rÃ©org, hypercroissance, transformationâ€¦"}
    },
    cap_cohesion: {
      hooks: [
        // AUTONOMIE
        "ğŸ‘ï¸ Vous n'avez pas besoin d'un audit pour savoir que votre Ã©quipe de direction dysfonctionne.",
        "ğŸ“‹ Vous avez dÃ©jÃ  fait des diagnostics RPS, des audits.\nEt aprÃ¨s ?",
        "ğŸ¯ Vous Ãªtes DGS. Vous voyez tout. Mais personne ne rÃ©gule ce que vous percevez.",
        "ğŸ›ï¸ Votre collectivitÃ© a besoin de cohÃ©sion au sommet.\nPas d'un Ã©niÃ¨me rapport.",
        // CONTRÃ”LE / LUCIDITÃ‰
        "ğŸ”‘ Vous n'avez pas besoin qu'on vous explique le problÃ¨me.\nVous avez besoin d'outils pour le rÃ©soudre.",
        "âš”ï¸ Reprendre la main sur la cohÃ©sion de votre Ã©quipe,\nÃ§a ne se sous-traite pas. Ã‡a se dÃ©cide.",
        "ğŸ’¡ Vous connaissez votre collectivitÃ© mieux que n'importe quel consultant.\nCe qui vous manque, ce sont les outils.",
        // FRUSTRATION
        "ğŸ˜¤ Les rapports s'empilent. Les recommandations restent lettre morte.\nVous le savez â€” c'est vous qui devez les mettre en Å“uvre.",
        "ğŸ“Š Des audits, vous en avez eu.\nDes rÃ©sultats, jamais."
      ],
      bodies: [
        // Silos et isolement
        "Vous vivez cette rÃ©alitÃ© au quotidien :\n\nğŸ´ Des directeurs qui fonctionnent en silos\nğŸ‹ï¸ Des projets transversaux qui n'avancent que quand vous poussez\nğŸ˜” Un sentiment d'isolement Ã  la tÃªte de la machine\n\nVous avez la compÃ©tence technique.\nCe qui vous manque : des outils pour rÃ©guler la dynamique humaine. ğŸ”§\n\nğŸ›ï¸ Cap CohÃ©sion :\nâœ… Cadre clair â€” espaces dÃ©finis, objectifs explicites, confidentialitÃ© absolue\nâœ… RÃ©gulation fine â€” lecture des dynamiques, ajustement en temps rÃ©el\nâœ… ContinuitÃ© â€” avant, pendant et aprÃ¨s les phases de tension\n\nğŸ¯ Vous restez maÃ®tre du calendrier.\nDÃ©cider avec clartÃ©. Avancer avec justesse. âœ¦",
        // Ã‰chec des audits
        "Les rapports s'empilent. Les recommandations restent lettre morte. ğŸ˜¤\n\nLe problÃ¨me des approches classiques :\n\nâŒ Elles dÃ©crivent le problÃ¨me sans donner les outils\nâŒ Elles ignorent la surcharge cognitive et les tensions invisibles\nâŒ Elles crÃ©ent de la dÃ©pendance au consultant\n\nğŸ›ï¸ Cap CohÃ©sion est l'inverse d'un audit.\nC'est un programme de rÃ©gulation. ğŸ’ª\n\nEn 6 mois, on ne touche pas aux processus.\nOn rÃ©gule l'humain qui les pilote. ğŸ§ \n\nğŸ¯ Vous jugez sur les rÃ©sultats, pas sur les promesses.\nAvant d'optimiser un systÃ¨me, il faut rÃ©guler l'humain qui le pilote. âœ¦",
        // Outils concrets
        "Vous n'avez pas besoin qu'on vous explique le problÃ¨me.\nVous avez besoin d'outils pour le rÃ©soudre. ğŸ”§\n\nCap CohÃ©sion vous donne ces outils :\n\nğŸ” Lecture des dynamiques invisibles de votre Ã©quipe\nâš¡ RÃ©gulation en temps rÃ©el des tensions\nğŸ“… Accompagnement continu sur 6 mois\nğŸ“Š RÃ©sultats mesurables Ã  chaque Ã©tape\n\nPas de jargon managÃ©rial importÃ© du privÃ©.\nDes protocoles adaptÃ©s aux rÃ©alitÃ©s du service public. ğŸ›ï¸\n\nVous restez dÃ©cideur. Nous, on rÃ©gule. âœ¦",
        // Autonomie post-accompagnement (nouveau)
        "Ce que Cap CohÃ©sion vous apporte, ce n'est pas une bÃ©quille.\nC'est l'autonomie. ğŸ”‘\n\nÃ€ l'issue des 6 mois :\n\nâœ… Votre Ã©quipe de direction sait nommer et traiter les tensions\nâœ… Les dynamiques de groupe sont lisibles â€” par vous\nâœ… Vous disposez d'outils de rÃ©gulation que vous maÃ®trisez\nâœ… Plus besoin de consultant permanent\n\nCap CohÃ©sion transfÃ¨re les compÃ©tences.\nVous repartez plus fort. Pas plus dÃ©pendant. ğŸ›ï¸\n\nDÃ©cider avec clartÃ©. Avancer avec justesse. âœ¦",
        // SpÃ©cificitÃ© service public (nouveau)
        "Ce qui rend la collectivitÃ© diffÃ©rente du privÃ© :\n\nğŸ›ï¸ Le temps politique n'est pas le temps managÃ©rial\nâš–ï¸ Les dÃ©cisions sont contraintes par le droit et l'intÃ©rÃªt gÃ©nÃ©ral\nğŸ‘¥ Les agents ne sont pas des Â« collaborateurs Â» â€” ils sont fonctionnaires\n\nLes mÃ©thodes importÃ©es du privÃ© ne fonctionnent pas ici.\nCap CohÃ©sion a Ã©tÃ© conÃ§u POUR le service public.\n\nğŸ”§ Cadre adaptÃ© aux contraintes institutionnelles\nğŸ” RÃ©gulation qui respecte les rÃ´les Ã©lus / administration\nğŸ“… Rythme ajustÃ© au calendrier de la collectivitÃ©\n\nVous gardez la main. On rÃ©gule. âœ¦"
      ],
      ctas: [
        "ğŸ’ª Vous connaissez votre collectivitÃ© mieux que personne. AvanÃ§ons.\nâ†’ lien en commentaire",
        "âœŠ Assez de diagnostics. Place Ã  la rÃ©gulation.\nCap CohÃ©sion â†’ lien en commentaire",
        "ğŸ›ï¸ Cap CohÃ©sion : rÃ©gulation sur 6 mois Â· RÃ©sultats mesurables\nâ†’ lien en commentaire",
        "ğŸ¯ Vous dÃ©cidez. Nous rÃ©gulons.\nCap CohÃ©sion â†’ lien en commentaire",
        "ğŸ”‘ Reprenez la main sur la dynamique de votre Ã©quipe.\nCap CohÃ©sion â†’ lien en commentaire",
        "ğŸ“ 20 minutes pour comprendre si Cap CohÃ©sion\nest adaptÃ© Ã  votre collectivitÃ©.\nâ†’ lien en commentaire"
      ],
      variables: ["collectivite"],
      placeholders: {"collectivite": "ex : commune, intercommunalitÃ©, dÃ©partementâ€¦"}
    }
  }
};

const META_OPTIONS = {
  seloigner: { name: "S'Ã©loigner de", icon: "ğŸ›¡ï¸", desc: "MotivÃ© par les problÃ¨mes Ã  Ã©viter" },
  ref_interne: { name: "RÃ©fÃ©rence interne", icon: "ğŸ¯", desc: "DÃ©cide par soi-mÃªme, autonome" }
};
const OFFRE_OPTIONS = {
  codir: { name: "CODIR", icon: "ğŸ¢", desc: "Entreprises & ETI" },
  cap_cohesion: { name: "Cap CohÃ©sion", icon: "ğŸ›ï¸", desc: "CollectivitÃ©s territoriales" }
};

let currentMeta = "seloigner";
let currentOffre = "codir";
let varValues = {};
let lastHook = -1, lastBody = -1, lastCta = -1;

const editor = document.getElementById("editor");
const charCount = document.getElementById("char-count");
const charBarFill = document.getElementById("char-bar-fill");
const overlimitMsg = document.getElementById("overlimit-msg");
const comboInfo = document.getElementById("combo-info");

function getBlocks() { return BLOCKS[currentMeta]?.[currentOffre]; }

function randIndex(arr, lastIdx) {
  if (arr.length <= 1) return 0;
  let idx;
  do { idx = Math.floor(Math.random() * arr.length); } while (idx === lastIdx);
  return idx;
}

function countCombos(b) { return b.hooks.length * b.bodies.length * b.ctas.length; }

function generatePost() {
  const b = getBlocks();
  if (!b) return;
  lastHook = randIndex(b.hooks, lastHook);
  lastBody = randIndex(b.bodies, lastBody);
  lastCta = randIndex(b.ctas, lastCta);
  let post = b.hooks[lastHook] + "\n\n" + b.bodies[lastBody] + "\n\n" + b.ctas[lastCta];
  // Inject variables
  Object.entries(varValues).forEach(([k, v]) => {
    if (v.trim()) post = post.replace(new RegExp("\\{\\{" + k + "\\}\\}", "g"), v);
  });
  editor.value = post;
  updateCharCounter();
}

function updateCharCounter() {
  const len = editor.value.length;
  const pct = Math.min((len / MAX_CHARS) * 100, 100);
  charBarFill.style.width = pct + "%";
  const over = len > MAX_CHARS, warn = len > MAX_CHARS * 0.9;
  charBarFill.className = "char-bar-fill " + (over ? "danger" : warn ? "warning" : "normal");
  charCount.className = "char-count " + (over ? "danger" : warn ? "warning" : "");
  charCount.textContent = len + " / " + MAX_CHARS;
  editor.classList.toggle("overlimit", over);
  if (over) { overlimitMsg.textContent = "âš ï¸ DÃ©passement de " + (len - MAX_CHARS) + " caractÃ¨res."; overlimitMsg.classList.add("visible"); }
  else overlimitMsg.classList.remove("visible");
}

function renderSelectors(id, options, current, onSelect) {
  const c = document.getElementById(id); c.innerHTML = "";
  Object.entries(options).forEach(([k, v]) => {
    const btn = document.createElement("button");
    btn.className = "selector-btn" + (k === current ? " active" : "");
    btn.innerHTML = '<div class="btn-icon">' + v.icon + '</div><div class="btn-name">' + v.name + '</div><div class="btn-desc">' + v.desc + '</div>';
    btn.addEventListener("click", () => onSelect(k));
    c.appendChild(btn);
  });
}

function renderVarFields() {
  const b = getBlocks(); if (!b) return;
  const container = document.getElementById("var-fields");
  container.innerHTML = "";
  varValues = {};
  b.variables.forEach(v => {
    varValues[v] = "";
    const ph = (b.placeholders && b.placeholders[v]) || "Tapez ici...";
    const div = document.createElement("div"); div.className = "var-field-group";
    div.innerHTML = '<label class="var-field-label">ğŸ“ ' + v + '</label><input type="text" class="var-field-input" data-var="' + v + '" placeholder="' + ph + '">';
    container.appendChild(div);
  });
  container.querySelectorAll(".var-field-input").forEach(input => {
    input.addEventListener("input", function() { varValues[this.dataset.var] = this.value; });
  });
  const combos = countCombos(b);
  comboInfo.innerHTML = "<strong>ğŸ² " + combos + " combinaisons possibles</strong> â€” " + b.hooks.length + " hooks Ã— " + b.bodies.length + " corps Ã— " + b.ctas.length + " CTA. Chaque clic sur Â« GÃ©nÃ©rer Â» crÃ©e un post unique.";
}

function selectMeta(k) {
  currentMeta = k; lastHook = lastBody = lastCta = -1;
  renderSelectors("meta-selectors", META_OPTIONS, currentMeta, selectMeta);
  renderVarFields(); generatePost();
}
function selectOffre(k) {
  currentOffre = k; lastHook = lastBody = lastCta = -1;
  renderSelectors("offre-selectors", OFFRE_OPTIONS, currentOffre, selectOffre);
  renderVarFields(); generatePost();
}

editor.addEventListener("input", updateCharCounter);

document.getElementById("btn-generate").addEventListener("click", generatePost);

document.getElementById("btn-copy").addEventListener("click", function() {
  const btn = this;
  navigator.clipboard.writeText(editor.value).then(() => {
    btn.textContent = "âœ“ CopiÃ© !"; btn.classList.add("copied");
    setTimeout(() => { btn.textContent = "Copier le post"; btn.classList.remove("copied"); }, 2000);
  }).catch(() => {
    editor.select(); document.execCommand("copy");
    btn.textContent = "âœ“ CopiÃ© !"; btn.classList.add("copied");
    setTimeout(() => { btn.textContent = "Copier le post"; btn.classList.remove("copied"); }, 2000);
  });
});

// INIT
renderSelectors("meta-selectors", META_OPTIONS, currentMeta, selectMeta);
renderSelectors("offre-selectors", OFFRE_OPTIONS, currentOffre, selectOffre);
renderVarFields();
generatePost();
</script>
</body>
</html>
